!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fantasy-land")):"function"==typeof define&&define.amd?define(["exports","fantasy-land"],e):e(t.creed=t.creed||{},t.fl)}(this,function(t,e){"use strict";function n(t){return(t.state()&ot)>0}function r(t){return(t.state()&it)>0}function o(t){return(t.state()&ut)>0}function i(t){return(t.state()&ct)>0}function u(t){return(t.state()&pt)>0}function c(t){return(t.state()&st)>0}function p(t){var e=t.near();if(!r(e))throw new TypeError("getValue called on "+t);return e.value}function s(t){var e=t.near();if(!o(e))throw new TypeError("getReason called on "+t);return f(e),e.value}function f(t){t._runAction(ft)}function a(t){return function(){return setTimeout(t,0)}}function h(t){return function(){return process.nextTick(t)}}function l(t){var e=document.createTextNode("");new ht(t).observe(e,{characterData:!0});var n=0;return function(){e.data=n^=1}}function y(t,e){try{v(e,t)}finally{e.length=0}}function v(t,e){for(var n=0;n<t.length;++n){var r=t[n];c(r)||e(r)}}function d(){}function _(t){return("object"==typeof t||"function"==typeof t)&&null!==t}function m(t,e,n,r){var o;try{o=t(e)}catch(t){return void r._reject(t)}n(r,o)}function b(t,e,n,r){return n._when(new gt(t,e,r)),r}function w(t,e){t._resolve(e)}function g(t){return Array.isArray(t)?new Array(t.length):[]}function j(t,e,n,r){var o=Array.isArray(n)?A:k;try{o(t,e,n,r)}catch(t){r._reject(t)}return r.near()}function A(t,e,n,r){for(var o=0;o<n.length;++o)T(t,e,n[o],o,r);e.complete(o,r)}function k(t,e,n,r){for(var o=0,i=n[Symbol.iterator]();;){var u=i.next();if(u.done)break;T(t,e,u.value,o++,r)}e.complete(o,r)}function T(t,e,n,i,u){if(!_(n))return void e.valueAt(n,i,u);var c=t(n);u._isResolved()?r(c)||f(c):r(c)?e.fulfillAt(c,i,u):o(c)?e.rejectAt(c,i,u):c._runAction(new kt(e,i,u))}function O(t){return C(t)?t.near():_(t)?V(S,t):new St(t)}function R(t){return new Et(t)}function P(){return new xt}function S(t){return new St(t)}function E(){var t=new Pt;return{resolve:function(e){return t._resolve(e)},promise:t}}function x(t){var e=new At(Mt,g(t));return H(e,t)}function M(t){return H(new jt(P),t)}function N(t){return"object"==typeof t&&null!==t}function H(t,e){if(!N(e))return R(new TypeError("expected an iterable"));var n=new Pt;return j(K,t,e,n)}function C(t){return t instanceof Rt}function K(t){return C(t)?t.near():V(S,t)}function V(t,e){try{var n=e.then;return"function"==typeof n?W(n,e):t(e)}catch(t){return new Et(t)}}function W(t,e){var n=new Pt;try{t.call(e,function(t){return n._resolve(t)},function(t){return n._reject(t)})}catch(t){n._reject(t)}return n.near()}function q(){return new Et(new TypeError("resolution cycle"))}function z(t,e){e._become(t)}function D(t){t._reject(new Kt("promise timeout"))}function F(t,e,n,r){function o(t){r._resolve(t)}function i(t){r._reject(t)}switch(n.length){case 0:t.call(e,o,i);break;case 1:t.call(e,n[0],o,i);break;case 2:t.call(e,n[0],n[1],o,i);break;case 3:t.call(e,n[0],n[1],n[2],o,i);break;default:n.push(o,i),t.apply(e,n)}return r}function B(t,e,n,r){function o(t,e){t?r._reject(t):r._fulfill(e)}switch(n.length){case 0:t.call(e,o);break;case 1:t.call(e,n[0],o);break;case 2:t.call(e,n[0],n[1],o);break;case 3:t.call(e,n[0],n[1],n[2],o);break;default:n.push(o),t.apply(e,n)}return r}function G(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return I(t,this,e)}}function I(t,e,n){var r=t.apply(e,n);return Dt(O,r,new Pt)}function J(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return U(B,t,this,e,new Pt)}}function L(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return U(B,t,this,e,new Pt)}function Q(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return U(F,t,this,e,new Pt)}function U(t,e,n,r,o){nt(e);try{t(e,n,r,o)}catch(t){o._reject(t)}return o}function X(t,e){var n=O(e);return t<=0||o(n)||u(n)?n:Ht(t,n,new Pt)}function Y(t,e){var n=O(e);return i(n)?n:Vt(t,n,new Pt)}function Z(t){return H(new qt,t)}function $(t){var e=new zt(O,g(t));return H(e,t)}function tt(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return et(t,this,e)}function et(t,e,n){var r=new At(new Bt(t,e),g(n));return H(r,n)}function nt(t){if("function"!=typeof t)throw new TypeError("must provide a resolver function")}function rt(){var t="function"==typeof Promise&&Promise;return"undefined"!=typeof self?self.Promise=It:"undefined"!=typeof global&&(global.Promise=It),t}e="default"in e?e.default:e;var ot=1,it=2,ut=4,ct=it|ut,pt=8,st=16,ft={fulfilled:function(){},rejected:function(t){t._state|=st}},at="undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process),ht="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver,lt=function(t){return at?h(t):ht?l(t):a(t)},yt=function(){var t=this;this.tasks=new Array(65536),this.length=0,this.drain=lt(function(){return t._drain()})};yt.prototype.add=function(t){0===this.length&&this.drain(),this.tasks[this.length++]=t},yt.prototype._drain=function(){for(var t=this.tasks,e=0;e<this.length;++e)t[e].run(),t[e]=void 0;this.length=0};var vt="unhandledRejection",dt="rejectionHandled",_t=function(t,e){this.rejections=[],this.emit=t,this.reportError=e};_t.prototype.track=function(t){this.emit(vt,t,t.value)||(0===this.rejections.length&&setTimeout(y,1,this.reportError,this.rejections),this.rejections.push(t))},_t.prototype.untrack=function(t){f(t),this.emit(dt,t)};var mt="unhandledRejection",bt=function(){return at&&"function"==typeof process.emit?function(t,e){return t===mt?process.emit(t,e.value,e):process.emit(t,e)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(t,e,n){var r;try{r=new n(mt)instanceof n}catch(t){r=!1}return r?function(t,r){var o=new n(t,{detail:{reason:r.value,promise:r},bubbles:!1,cancelable:!0});return!e.dispatchEvent(o)}:t}(d,self,CustomEvent):d},wt=function(t){this.promise=t};wt.prototype.fulfilled=function(t){this.promise._become(t)},wt.prototype.rejected=function(t){return this.promise._become(t),!1};var gt=function(t){function e(e,n,r){t.call(this,r),this.f=e,this.r=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fulfilled=function(t){this.runThen(this.f,t)},e.prototype.rejected=function(t){return this.runThen(this.r,t)},e.prototype.runThen=function(t,e){return"function"!=typeof t?(this.promise._become(e),!1):(m(t,e.value,w,this.promise),!0)},e}(wt),jt=function(t){this.never=t};jt.prototype.valueAt=function(t,e,n){n._fulfill(t)},jt.prototype.fulfillAt=function(t,e,n){n._become(t)},jt.prototype.rejectAt=function(t,e,n){n._isResolved()?f(t):n._become(t)},jt.prototype.complete=function(t,e){0===t&&e._become(this.never())};var At=function(t,e){this.pending=0,this.results=e,this.mergeHandler=t};At.prototype.valueAt=function(t,e,n){this.results[e]=t,this.check(this.pending-1,n)},At.prototype.fulfillAt=function(t,e,n){this.valueAt(t.value,e,n)},At.prototype.rejectAt=function(t,e,n){n._isResolved()?f(t):n._become(t)},At.prototype.complete=function(t,e){this.check(this.pending+t,e)},At.prototype.check=function(t,e){this.pending=t,0===t&&this.mergeHandler.merge(e,this.results)};var kt=function(t){function e(e,n,r){t.call(this,r),this.i=n,this.handler=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fulfilled=function(t){this.handler.fulfillAt(t,this.i,this.promise)},e.prototype.rejected=function(t){return this.handler.rejectAt(t,this.i,this.promise)},e}(wt),Tt=new yt,Ot=new _t(bt(),function(t){throw t.value}),Rt=function(){};Rt.empty=function(){return P()},Rt.of=function(t){return S(t)},Rt[e.empty]=function(){return P()},Rt[e.of]=function(t){return S(t)},Rt.prototype[e.map]=function(t){return this.map(t)},Rt.prototype[e.bimap]=function(t,e){return this.bimap(t,e)},Rt.prototype[e.ap]=function(t){return t.ap(this)},Rt.prototype[e.chain]=function(t){return this.chain(t)},Rt.prototype[e.concat]=function(t){return this.concat(t)},Rt.prototype[e.alt]=function(t){return this.or(t)},Rt[e.zero]=function(){return P()},Rt.prototype.concat=function(t){return this.or(t)};var Pt=function(t){function e(){t.call(this),this.ref=void 0,this.action=void 0,this.length=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function t(n,r){var o=this.near();return o===this?t(n,r,this,new e):o.then(n,r)},e.prototype.catch=function(t){var n=this.near();return n===this?b(void 0,t,this,new e):n.catch(t)},e.prototype.map=function t(n){var r=this.near();return r===this?t(n,this,new e):r.map(n)},e.prototype.bimap=function t(n,r){var o=this.near();return o===this?t(n,r,this,new e):o.bimap(n,r)},e.prototype.ap=function(t){var e=this.near(),n=t.near();return e===this?this.chain(function(t){return n.map(t)}):e.ap(n)},e.prototype.chain=function t(n){var r=this.near();return r===this?t(n,this,new e):r.chain(n)},e.prototype.or=function(t){var e=this.near(),n=t.near();return i(e)||u(n)?e:i(n)||u(e)?n:M([e,n])},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){var t=this.near();return t===this?"Promise { pending }":t.inspect()},e.prototype.near=function(){return this._isResolved()?(this.ref=this.ref.near(),this.ref):this},e.prototype.state=function(){return this._isResolved()?this.ref.near().state():ot},e.prototype._isResolved=function(){return void 0!==this.ref},e.prototype._when=function(t){this._runAction(t)},e.prototype._runAction=function(t){void 0===this.action?this.action=t:this[this.length++]=t},e.prototype._resolve=function(t){this._become(O(t))},e.prototype._fulfill=function(t){this._become(new St(t))},e.prototype._reject=function(t){this._isResolved()||this.__become(new Et(t))},e.prototype._become=function(t){this._isResolved()||this.__become(t)},e.prototype.__become=function(t){this.ref=t===this?q():t,void 0!==this.action&&Tt.add(this)},e.prototype.run=function(){var t=this,e=this.ref.near();e._runAction(this.action),this.action=void 0;for(var n=0;n<this.length;++n)e._runAction(t[n]),t[n]=void 0},e}(Rt),St=function(t){function e(e){t.call(this),this.value=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function t(e){return"function"==typeof e?t(e,void 0,this,new Pt):this},e.prototype.catch=function(){return this},e.prototype.map=function t(e){return t(e,this,new Pt)},e.prototype.bimap=function(t,e){return this.map(e)},e.prototype.ap=function(t){return t.map(this.value)},e.prototype.chain=function t(e){return t(e,this,new Pt)},e.prototype.or=function(){return this},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){return"Promise { fulfilled: "+this.value+" }"},e.prototype.state=function(){return it},e.prototype.near=function(){return this},e.prototype._when=function(t){Tt.add(new Nt(t,this))},e.prototype._runAction=function(t){t.fulfilled(this)},e}(Rt),Et=function(t){function e(e){t.call(this),this.value=e,this._state=ut,Ot.track(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function(t,e){return"function"==typeof e?this.catch(e):this},e.prototype.catch=function(t){return b(void 0,t,this,new Pt)},e.prototype.map=function(){return this},e.prototype.bimap=function t(e){return t(e,void 0,this,new Pt)},e.prototype.ap=function(){return this},e.prototype.chain=function(){return this},e.prototype.or=function(){return this},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){return"Promise { rejected: "+this.value+" }"},e.prototype.state=function(){return this._state},e.prototype.near=function(){return this},e.prototype._when=function(t){Tt.add(new Nt(t,this))},e.prototype._runAction=function(t){t.rejected(this)&&Ot.untrack(this)},e}(Rt),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function(){return this},e.prototype.catch=function(){return this},e.prototype.map=function(){return this},e.prototype.bimap=function(){return this},e.prototype.ap=function(){return this},e.prototype.chain=function(){return this},e.prototype.or=function(t){return t},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){return"Promise { never }"},e.prototype.state=function(){return ot|pt},e.prototype.near=function(){return this},e.prototype._when=function(){},e.prototype._runAction=function(){},e}(Rt),Mt={merge:function(t,e){t._fulfill(e)}},Nt=function(t,e){this.action=t,this.promise=e};Nt.prototype.run=function(){this.promise._runAction(this.action)};var Ht=function(t,e,n){return e._runAction(new Ct(t,n)),n},Ct=function(t){function e(e,n){t.call(this,n),this.time=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fulfilled=function(t){setTimeout(z,this.time,t,this.promise)},e}(wt),Kt=function(t){function e(n){t.call(this),this.message=n,this.name=e.name,"function"==typeof t.captureStackTrace&&t.captureStackTrace(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Vt=function(t,e,n){var r=setTimeout(D,t,n);return e._runAction(new Wt(r,n)),n},Wt=function(t){function e(e,n){t.call(this,n),this.timer=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fulfilled=function(t){clearTimeout(this.timer),this.promise._become(t)},e.prototype.rejected=function(e){return clearTimeout(this.timer),t.prototype.rejected.call(this,e)},e}(wt),qt=function(){this.pending=0};qt.prototype.valueAt=function(t,e,n){n._fulfill(t)},qt.prototype.fulfillAt=function(t,e,n){n._become(t)},qt.prototype.rejectAt=function(t,e,n){f(t),this.check(this.pending-1,n)},qt.prototype.complete=function(t,e){this.check(this.pending+t,e)},qt.prototype.check=function(t,e){this.pending=t,0===t&&e._reject(new RangeError("No fulfilled promises in input"))};var zt=function(t,e){this.pending=0,this.results=e,this.resolve=t};zt.prototype.valueAt=function(t,e,n){this.settleAt(this.resolve(t),e,n)},zt.prototype.fulfillAt=function(t,e,n){this.settleAt(t,e,n)},zt.prototype.rejectAt=function(t,e,n){f(t),this.settleAt(t,e,n)},zt.prototype.settleAt=function(t,e,n){this.results[e]=t,this.check(this.pending-1,n)},zt.prototype.complete=function(t,e){this.check(this.pending+t,e)},zt.prototype.check=function(t,e){this.pending=t,0===t&&e._fulfill(this.results)};var Dt=function(t,e,n){return new Ft(t,e,n).run(),n},Ft=function(t){function e(e,n,r){t.call(this,r),this.resolve=e,this.generator=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.run=function(){this.tryStep(this.generator.next,void 0)},e.prototype.tryStep=function(t,e){var n;try{n=t.call(this.generator,e)}catch(t){return void this.promise._reject(t)}this.handle(n)},e.prototype.handle=function(t){return t.done?this.promise._resolve(t.value):void this.resolve(t.value)._when(this)},e.prototype.fulfilled=function(t){this.tryStep(this.generator.next,t.value)},e.prototype.rejected=function(t){return this.tryStep(this.generator.throw,t.value),!0},e}(wt),Bt=function(t,e){this.f=t,this.c=e,this.promise=void 0,this.args=void 0};Bt.prototype.merge=function(t,e){this.promise=t,this.args=e,Tt.add(this)},Bt.prototype.run=function(){try{this.promise._resolve(this.f.apply(this.c,this.args))}catch(t){this.promise._reject(t)}};var Gt=[],It=function(t){function e(e){t.call(this),U(F,e,void 0,Gt,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Pt);It.resolve=O,It.reject=R,It.all=x,It.race=M,"function"!=typeof Promise&&rt(),t.resolve=O,t.reject=R,t.future=E,t.never=P,t.fulfill=S,t.all=x,t.race=M,t.isFulfilled=r,t.isRejected=o,t.isSettled=i,t.isPending=n,t.isNever=u,t.getValue=p,t.getReason=s,t.coroutine=G,t.fromNode=J,t.runNode=L,t.runPromise=Q,t.delay=X,t.timeout=Y,t.any=Z,t.settle=$,t.merge=tt,t.shim=rt,t.Promise=It,Object.defineProperty(t,"__esModule",{value:!0})});